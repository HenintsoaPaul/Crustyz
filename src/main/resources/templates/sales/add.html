<div th:replace="~{fragments/_layout}"></div>

<main id="main" class="main">
    <h2>Save Sale</h2>
    <form th:action="@{/sales/save}" th:object="${saleDTO}" method="POST" id="saleForm">
        <input type="date" required
               th:field="*{sale.daty}" class="form-control mb-4 col-4">

        <input type="text"
               th:field="*{sale.customerName}"
               value="Anonymous" class="form-control mb-4 col-4">

        <!-- Sale details (this is the container where the dynamic details will be added) -->
        <div id="filles_container">
            <div th:each="elmt, iterator :${saleDTO.saleDetails}"
                 th:id="'detail-' + iterator.index" class="fille_detail">
                <div>
                    <label th:for="'qte-' + iterator.index"
                           class="col-md-3 control-label">Quantit�</label>
                    <input th:id="'qte-' + iterator.index"
                           th:field="*{saleDetails[__${iterator.index}__].quantity}"
                           class="form-control mb-4 col-4" type="number" min="0">
                </div>
                <div class="form-group">
                    <label th:for="'productsList-' + iterator.index"
                           class="col-md-3 control-label">Produit</label>
                    <select th:id="'productsList-' + iterator.index"
                            th:field="*{saleDetails[__${iterator.index}__].product}"
                            class="form-control mb-4 col-4"
                            required>
                        <option th:each="elmt:${productStocksList}"
                                th:value="${elmt.getProduct().getId()}"
                                th:text="${elmt.getProduct().getName()}  + '--' + ${elmt.getQuantity}"
                                th:title="${elmt.getProduct().getName()}  + '--' + ${elmt.getQuantity}">
                        </option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Button to add a new sale detail -->
        <button type="button" class="btn btn-secondary col-2" id="addFilleBtn">Ajouter D�tail Vente</button>

        <button type="submit" class="btn btn-info col-2">Submit</button>
    </form>
    <hr>
    <a th:href="@{/sales}"> Back to Sale List</a>
</main>

<div th:replace="~{fragments/footer}"></div>

</body>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const containerName = 'filles_container';
        const childrenClass = '.fille_detail';

        document.getElementById('addFilleBtn').addEventListener('click', function () {
            ajouterInputFille(containerName, childrenClass);
        });
    });
</script>
</html>
